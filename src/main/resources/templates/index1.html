
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRRO :: Visitor Login</title>
    <link rel="icon" href="logo/logo.png" type="image/x-icon">
    <link rel="shortcut icon" href="logo/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.12/dist/cropper.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.12/dist/cropper.min.css">
 <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
 <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

</head>
<body>
	
	<div class="overlay" id="overlay"></div>
    
    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="fading-bars">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
    </div>
	
    <h2>Visitor Profile</h2>
    <div class="container" x-data="formValidation()">
        <div class="justify-content-md-evenly">
            <img src="/logo/logo.png" alt="FRRO Logo">
            <div>
                <h7 style="margin-left: 20px; font-style: oblique;">FRRO CHENNAI</h7>
            </div>
        </div>
    
      
        <!-- <div class="form-group">
            <label for="webcamPreview" class="form-label">Image Preview</label>
            <img id="webcamPreview" class="img-thumbnail" style="width: 100px; height: 100px;">
            <input type="hidden" id="webcamDataUrl" name="webcamDataUrl">
        </div> -->
		<form th:action="@{/Frro/savedata}" class="form" id="user-form" @submit.prevent="validateForm" method="post"  enctype="multipart/form-data"  th:object="${visitorEntry}">
            <!-- Replace `newVisitor` with the correct model object name -->
                <div class="row">
                    <div class="image-preview-container">
						 <label for="webcamPreview" class="form-label" style=" margin-left: 10px; color: rgb(192, 192, 192);"><span class="glyphicon glyphicon-picture"></span> Image Preview</label>

                        <img id="webcamPreview" class="img-thumbnail" style="width: 150px; height: 200px; border-color: rgb(90, 224, 224); border-radius: 5px; border-width: 2.5px;">
                        <input type="hidden" id="webcamDataUrl" name="webcamDataUrl" x-bind:value="webcamDataUrl">

            
                    </div>
                  
                <div class="col-md-4 col-12">
                    <label for="visitor_full_name" class="form-label">Visitor Name<span class="text-danger">*</span></label>
                    <input type="text" id="visitor_full_name" name="visitor_full_name" class="form-control" th:field="*{visitor_full_name}"  
                     @keyup="visitor_full_name = visitor_full_name.toUpperCase()"   x-model="visitor_full_name" 
                     @input="validateField('visitor_full_name')" x-ref="visitor_full_name" :data-focused="errors.visitor_full_name && isFocused.visitor_full_name">
                    <span x-show="errors.visitor_full_name" x-html="errors.visitor_full_name" class="error"></span> 

                </div>
                <div class="col-md-3 col-12" >
                    <label for="visitor_id_type_id" class="form-label">Visitor ID Type</label>
                    <select name="visitor_id_type_id" id="visitor_id_type_id" th:field="*{visitor_id_type_id}" class="form-control" x-model="visitor_id_type_id" x-ref="visitor_id_type" x-on:change="updateVisitorIdTypeLabel">
                        <option value="0">-- Please Select --</option>
                    <!--    <option th:each="typeid : ${visitortypeid}" th:value="${typeid}" th:text="${typeid}"></option>-->
 								<option value="1">Driving License</option>
 								 <option value="2">Passport</option>
 								  <option value="3">Arms License</option>
 								   <option value="4">RationCard</option>
 								    <option value="5">IncomeTax PAN Card</option>
 								     <option value="6">Photo Credit Card</option>
                    </select>
                </div>
                <div class="col-md-3 col-12">     
					               <div class="form-group" >				
           <label for="visitor_id_type" class="form-label" x-text="visitorIdTypeLabel"></label>
                    <input type="text" id="visitor_id_type" name="visitor_id_type" th:field="*{visitor_id_type}" class="form-control" :placeholder="visitorIdTypeLabel "   oninput="this.value = this.value.toUpperCase()" x-model="visitor_id_type" x-ref="visitor_id_type" >
                </div>
            </div>
            <!-- <div class="col-md-2 col-12 d-flex justify-content-end">
                <div class="form-group">
                    <label for="webcamPreview" class="form-label">Image Preview</label>
                    <img id="webcamPreview" class="img-thumbnail" style="width: 200px; height: 150px;">
                    <input type="hidden" id="webcamDataUrl" name="webcamDataUrl">
                </div>
            </div> -->
                </div>
           <div class="row">
                <div class="col-md-10 col-12">
                  <div class="form-group">
                <label for="visitor_address" class="form-label">Visitor Address<span class="text-danger">*</span></label>
                  <div class="controls">
                <textarea id="visitor_address" name="visitor_address" th:field="*{visitor_address}" class="form-control" @keyup="visitor_address = visitor_address.toUpperCase()"  x-model="visitor_address" @input="validateField('visitor_address')" x-ref="visitor_address" :data-focused="errors.visitor_address && isFocused.visitor_address"></textarea>
                <span x-show="errors.visitor_address" x-html="errors.visitor_address" class="error"></span>
            </div>
                    </div>
        </div>
       
    </div> 
            <div class="row">
                <div class="col-md-10 col-12">
                    <label for="applicant_full_name" class="form-label">Applicant Name<span class="text-danger">*</span></label>
                    <span style="padding-left:20px;">
                        <input type="checkbox" tabindex="5" id="chkApplEqlsVstrName" name="chkApplEqlsVstrName"  x-model="blnApplEqlsVstrName" @change="syncApplicantName" x-show>
                        <label for="chkApplEqlsVstrName" style="color: rgb(0, 128, 192); font-size: small;" class="form-label">Same as visitor name</label>
                    </span>
                    <div class="controls">
                    <input type="text" id="applicant_full_name" name="applicant_full_name" th:field="*{applicant_full_name}" class="form-control"   x-model="applicant_full_name"@keyup="applicant_full_name=applicant_full_name.toUpperCase()" @input="validateField('applicant_full_name')"  x-ref="applicant_full_name" :data-focused="errors.applicant_full_name && isFocused.applicant_full_name">
                    <span x-show="errors.applicant_full_name" x-html="errors.applicant_full_name" class="error"></span> 
                </div>
            </div>
            
            </div>
            <div class="row">
                <div class="col-md-5 col-12">
                    <label for="passportid" class="form-label">Passport No:<span class="text-danger">*</span></label>
                     <span style="padding-left:10px;">
            <input type="checkbox" tabindex="5" id="chkIdEqualsPassport" name="chkIdEqualsPassport" x-model="blnIdEqualsPassport" @change="syncPassportNo()" :disabled="visitor_id_type_id !== '2'">
            <label for="chkIdEqualsPassport" style="color: rgb(0, 128, 192); font-size:small;" class="form-label">Same as Passport no in ID Type</label>
        </span>
                    <input type="text" id="applicant_ppt_no" name="applicant_ppt_no"  th:field="*{applicant_ppt_no}" class="form-control"  @keyup="applicant_ppt_no = applicant_ppt_no.toUpperCase()" maxlength="20"   x-model="applicant_ppt_no" @input="validateField('applicant_ppt_no')" x-ref="applicant_ppt_no" :data-focused="errors.applicant_ppt_no && isFocused.applicant_ppt_no">
                    <span x-show="errors.applicant_ppt_no" x-html="errors.applicant_ppt_no" class="error"></span> 

                </div>
                <div class="col-sm-5 col-12">
                    <label for="applicant_nationality"  class="form-label">Nationality<span class="text-danger">*</span></label>
                    <select  id="applicant_nationality" name="applicant_nationality" th:field="*{applicant_nationality}" class="form-control"    x-model="applicant_nationality" @change="validateField('applicant_nationality')" x-ref="applicant_nationality" :data-focused="errors.applicant_nationality && isFocused.applicant_nationality">
                        
                    <option value=""> -- Select Country --</option>
           <option th:each="nationality : ${country}" th:value="${nationality}" th:text="${nationality}"></option>
             
 
       </select>
                    <span x-show="errors.applicant_nationality" x-text="errors.applicant_nationality" class="error"></span> 
                </div>
                 <div class="col-md-2 col-12">
          <button type="button" class="btn btn-info" data-toggle="modal" data-target="#camModal"  style="margin-left:40%;"  x-bind:disabled="!showButton()" >
                    <span class="glyphicon glyphicon-picture"></span> Upload Photo
                </button>
                </div>
            </div> 
            <div class="row" >
                <div class="col-md-1 col-12" >
                    <div class="form-group">
                        <label for="" class="form-label">Local</label>
                        <div class="controls">
                            <input type="text" id="txtCodeIndia" name="txtCodeIndia"  class="form-control" disabled value="+91" >
                            
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-12" >
                    <div class="form-group">
                        <label for="ContactNoIndia" class="form-label">Contact No.<span class="text-danger">*</span>
                            <small><i>India</i></small></label>
                        <div class="">
                            <input type="text"  id="visitor_contact_no_india" th:field="*{visitor_contact_no_india}" name="visitor_contact_no_india"  autocomplete="off"  maxlength="10" class="form-control" style="width:90%" x-model="visitor_contact_no_india" @input="validateField('visitor_contact_no_india')" x-ref="visitor_contact_no_india" :data-focused="errors.visitor_contact_no_india && isFocused.visitor_contact_no_india">
                            <span x-show="errors.visitor_contact_no_india" x-html="errors.visitor_contact_no_india" class="error"></span> 
                          
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="form-group">
                        <label for="" class="form-label">Country Code</label>
                        <div class="controls">
                            <select x-model="visitor_country_code_num" id="visitor_country_code_num" name="visitor_country_code_num" th:field="*{visitor_country_code_num}"  class="form-control" style="margin: right 40%; width: 100%;">
                          
                               <option value="">-- Select Country Code--</option>

                        <option th:each="countryCode : ${code}" th:value="${countryCode}" th:text="${countryCode}"></option>
                               
                                
 
                            </select>
                            
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="form-group" x-show="visitor_country_code_num !== ''">
                        <label for="" class="form-label">Contact No.
                            <small><i>International</i></small></label>
                        <div class="controls" >
                            <input type="text" id="visitor_contact_no_intnl" name="visitor_contact_no_intnl" th:field="*{visitor_contact_no_intnl}" style="width: 95%;" autocomplete="off" class="form-control" x-model="visitor_contact_no_intnl" data-validation-containsnumber-regex="(\d)+" data-validation-containsnumber-message="No Characters Allowed, Only Numbers" maxlength="15" pattern="[0-9]{10,15}" data-validation-pattern-message="Invalid Contact No. !" placeholder="Enter Your INTL No:">
                            
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-md-5 col-12">
                    <div class="form-group">
                        <label for="visitor_visit_purpose_id" class="form-label">Purpose of Visit:<span class="text-danger">*</span></label>
                        <div class="controls">
                            <select x-model="visitor_visit_purpose_id" id="visitor_visit_purpose_id" name="visitor_visit_purpose_id" th:field="*{visitor_visit_purpose_id}"  class="form-control"  @change="validateField('visitor_visit_purpose_id')" x-ref="visitor_visit_purpose_id" :data-focused="errors.visitor_visit_purpose_id && isFocused.visitor_visit_purpose_id"  >
                                <option value="">-- Select --</option>
<!--                         <option th:each="visitorpurpose : ${visitorDesc}" th:value="${visitorpurpose}" th:text="${visitorpurpose}"></option>
-->
                     <option value="1">Registration Of VISA</option>
                                <option value="2">VISA Extension</option>
                                <option value="3">VISA Conversion</option>
                                <option value="4">Exit Permit</option>
                                <option value="5">online e Frro</option>
                                <option value="6">e Frro Payment</option>
                                 <option value="35">Others</option>

                                
                                
                            </select>
                            <span x-show="errors.visitor_visit_purpose_id" x-text="errors.visitor_visit_purpose_id" class="error"></span> 

                            
                        </div>
                    </div>

                </div>
                <div class="col-md-5 col-12"  x-show="visitor_visit_purpose_id == '35'">
                    <div class="form-group">
                        <label for="" class="form-label"> Purpose :<span class="text-danger">*</span></label>
                        <div class="controls">
                            <input type="text" id="visit_purpose_other_desc" name="visit_purpose_other_desc" th:field="*{visit_purpose_other_desc}"   class="form-control" style="width: 95%;"   placeholder="  purpose." oninput="this.value = this.value.toUpperCase()">
                        </div>
                    </div>
                </div>
              </div>
               <!-- Photo upload section 
            <div class="row" style="margin-left: 5px;">
                <div class="col-md-6 col-12">
                    <div class="form-group">
                        <label for="photo" class="form-label">Visitor Photo</label>
                        <div class="controls">
                            <input type="file" id="photo" name="photo" class="form-control" accept="image/*" capture="environment" style="width: 90%;" @change="encodeImage">
                        </div>
                        <span x-show="errors.photo" x-html="errors.photo" class="error"></span>
                    </div>
                </div>
                <div class="col-md-6 col-12">
                    <div class="form-group">
                        <label for="photoPreview" class="form-label">Preview</label>
                        <img id="photoPreview" class="img-thumbnail" style="width: 100px; height: 100px;" x-bind:src="photoDataUrl">
                    </div>
                </div>
            </div>-->
            	
            
             <!--web Cam
            <div class="row" style="margin-left: 5px;">
                <div class="col-md-6 col-12">
                    <div class="form-group">
                        <label for="webcam" class="form-label">Upload Image</label>
                        <div class="controls">
						<button type="button" @click="toggleWebcam" x-text="webcamButtonText" style="padding: 10px 15px; background-color: rgb(8, 157, 226); color: #fff;border: none;
						border-radius: 5px;cursor: pointer;font-size: small; "></button>
                            <video id="webcam" style="width: 90%;" autoplay></video>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-12">
                    <div class="form-group">
                        <label for="webcamPreview" class="form-label">Image Preview</label>
                        <img id="webcamPreview" class="img-thumbnail" style="width: 100px; height: 100px;" x-bind:src="webcamDataUrl">
                            <input type="hidden" name="webcamDataUrl" x-bind:value="webcamDataUrl">

                    </div>
                </div>
            </div>-->
            <div class="container">
                <!-- Trigger the modal with a button -->
                
            
             <!-- Modal -->
    <div class="modal fade" id="camModal" tabindex="-1" data-backdrop="static" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-scrollable" role="document">

            <!-- Modal content-->
 <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Upload Your Image</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row" style="margin-left: 5px;">
                            <div class="col-xs-12 col-md-10">
                                <div class="form-group">
                                    <label for="webcam" class="form-label">Upload Image</label>
                                    <div class="controls">
                                        <button type="button" id="toggleWebcam" class="btn btn-primary" style="padding: 10px 15px; background-color: rgb(8, 157, 226); color: #fff; border: none; border-radius: 5px; cursor: pointer; font-size: small;">  
                                            <span class="glyphicon glyphicon-camera"></span> Start Camera
                                        </button>
                                        <video id="webcam" style="width: 100%;" autoplay></video>
                                        <button type="button" id="captureImage" class="btn btn-primary mt-2"> 
                                            <span class="glyphicon glyphicon-saved"></span> Capture Image
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="cropperContainer" style="display:none;">
                            <img id="cropperImage" style="max-width: 100%;" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="cropImage" class="btn btn-success" data-dismiss="modal">
                            <span class="glyphicon glyphicon-edit"></span> Crop Image
                        </button>
                    </div>
                </div>
        </div>
    </div>
            </div>


<div class="row">
    <!-- Left Side: Back Button -->
    <div class="col-md-6 col-12 text-left">
             <button onclick="window.history.back()" class="btn btn-secondary mb-3">
            <span class="glyphicon glyphicon-arrow-left"></span> Back
        </button>
    </div>
    <div class="col-md-6 col-12 text-right">
        <div class="button-container">
            <button type="button" @click="resetForm" class="reset">
                <span class="glyphicon glyphicon-refresh"></span> Reset
            </button>
            <button
                type="submit"
                @click="validateForm()"
                :disabled="!isFormValid"
                @mouseover="showFormErrors"
                @mouseleave="hideFormErrors"
                class="submit"
            >
                <span class="glyphicon glyphicon-ok"></span> Submit
            </button>
        </div>
    </div>
</div>
<div x-show="formError" class="form-error" x-text="formError"></div>

                
           </form>
<!-- Modal -->
<!-- Modal -->
<div class="modal fade" id="alertModal" tabindex="-1" data-backdrop="static" role="dialog" aria-labelledby="alertModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title text-primary" id="alertModalLabel">Save Data Successfully</h4>
            </div>
            <div class="modal-body">
                <h2 class="text-dark font-serif">
                    <!-- Display the success message -->
                    <span th:text="${message}"></span>
                </h2>
            </div>
            <div class="col-md-12">
				              <h4 class="text-success">Please Ensure Your Important Details</h4>

			</div>
                     
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <div class="info" style="margin-left:30px; margin-top:30px; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;">
				<p>TOKEN NO : <span th:text="${token}" style="font-size: large; color: rgb(255, 128, 192);" ></span></p>
				<p>For the DATE :  <span th:text="${date}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>
                <p>PASSPORT : <span th:text="${passport}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>
                <p>ADDRESS  : <span th:text="${address}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>
                <p>ID TYPE  : <span th:text="${idtype}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>
                <p>APPLICANT NAME: <span th:text="${applicantname}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>
                <p>CONTACT NO : <span th:text="${localno}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>
                <p>NATIONALITY : <span th:text="${nationality}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>
             <p>PURPOSE : <span th:text="${purpose}"  style="font-size: medium; color: rgb(255, 128, 192);"></span></p>

            </div>
        </div>
        <div class="col-md-4">
            <div class="image-preview-container">
<!--                <img th:src="${image != 'NA' ? 'data:image/jpeg;base64,' + image : '/path/to/default/image.jpg'}" 
-->                    <img th:src="'data:image/jpeg;base64,' + ${image}" alt="visitor_img" class="img-thumbnail" 
                     style="width: 150px; height: 200px; border-color: rgb(90, 224, 224); border-radius: 5px; border-width: 2.5px;" >
                  
                <label for="webcamPreview" class="form-label" style="padding: 5px; margin-left: 15px; color: rgb(232, 79, 217);">
                    <span class="glyphicon glyphicon-file"></span> Image Preview
                </label>
            </div>
        </div>
    </div>
</div>

            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>




 
            
        
    </div>
       
    

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

          
  
  <script>
	
 /*  $('#alertModal').modal('show');
        $(document).ready(function() {
        $('#submitBtn').click(function(event) {
            event.preventDefault(); // Prevent the default form submission
            
            // Optionally, you can set the message dynamically if needed
        var message = /*[[${message}]]*/ '';
           // $('#modalMessage').text(message); // Set the message in the modal

        $(document).ready(function() {
            // Check if the query parameter "saved" is present
            var urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('saved')) {
                $('#alertModal').modal('show');
            }
        });
          document.addEventListener('DOMContentLoaded', function() {
        $('#alertModal').on('hide.bs.modal', function () {
            window.location.href = '/';
        });
    });
      
   
    
    function formValidation() {
        return {
            visitor_full_name: '',
            visitor_address: '',
            applicant_full_name: '',
            applicant_ppt_no: '',
            visitor_id_type_id:'',
            visitor_id_type:'',
            applicant_nationality: '',
            visitor_contact_no_india: '',
            visitor_visit_purpose_id:'',
            blnApplEqlsVstrName: false,
            blnIdEqualsPassport:false,
            visitor_country_code_num:'',
            visitor_contact_no_intnl:'',
            webcamDataUrl:'',
			/*webcamDataUrl: '',
			webcamButtonText: 'StartCmera',
	        webcamActive: false,
	        webcamStream: null,*/
	        
            errors: {
                visitor_full_name: '',
                visitor_address: '',
                applicant_full_name: '',
                applicant_ppt_no: '',
                applicant_nationality: '',
                visitor_contact_no_india: '',
                visitor_visit_purpose_id:'',
                visitor_country_code_num:'',
                visitor_contact_no_intnl:'',
                
            },
            isFocused: {
            visitor_full_name: false,
            visitor_address: false,
            applicant_full_name: false,
            applicant_ppt_no: false,
            applicant_nationality: false,
            visitor_contact_no_india: false,
            visitor_visit_purpose_id: false,
            visitor_country_code_num:'',
            visitor_id_type_id:false,
           
            },
 formError: '',
        submitHovered: false, 
                    get isFormValid() {
                return !this.errors.visitor_full_name &&
                       !this.errors.visitor_address &&
                       !this.errors.applicant_full_name &&
                       !this.errors.applicant_ppt_no &&
                       !this.errors.applicant_nationality &&
                       !this.errors.visitor_contact_no_india &&
                       !this.errors.visitor_visit_purpose_id &&
                       
                       this.visitor_full_name &&
                       this.visitor_address &&
                       this.applicant_full_name &&
                       this.applicant_ppt_no &&
                       this.applicant_nationality &&
                       this.visitor_contact_no_india &&
                       this.visitor_visit_purpose_id  
                       
            },
            validateField(field) {
                this.isFocused[field] = true;
                switch(field) {
                    case 'visitor_full_name':
                        if (this.visitor_full_name.trim() === '') {
                            this.errors.visitor_full_name = 'This is required';
                        } else if (this.visitor_full_name.length < 3) {
                            this.errors.visitor_full_name = 'Invalid!!<br>Visitorname must be at least 3 characters long.';
                        } else if (!/^[a-zA-Z\s]+$/.test(this.visitor_full_name)) {
                            this.errors.visitor_full_name = 'Invalid!!<br>Please enter only alphabetic characters in the Visitorname field.';
                        } else {
                            this.errors.visitor_full_name = '';
                        }
                        break;
						                    
						case 'visitor_address':
						    if (this.visitor_address.trim() === '') {
						        this.errors.visitor_address = 'This is required';
						    } else if (this.visitor_address.length < 5) {
						        this.errors.visitor_address = 'Invalid! Address must be at least 5 characters long.';
						    } else if (!/^[a-zA-Z0-9\s,.]+$/.test(this.visitor_address)) {
						        this.errors.visitor_address = 'Invalid! Only alphanumeric characters should be  allowed.';
						    } else {
						        this.errors.visitor_address = '';
						    }
						    break;
                    case 'applicant_full_name':
                     if (this.applicant_full_name === '') {
                            this.errors.applicant_full_name = 'This is required';
                        } else if (this.applicant_full_name.length < 3) {
                            this.errors.applicant_full_name = 'Invalid!!<br>Applicant name must be at least 3 characters long.';
                        } else if (!/^[a-zA-Z\s]+$/.test(this.applicant_full_name)) {
                            this.errors.applicant_full_name = 'Invalid!!<br>Please enter only alphabetic characters in the Applicant name field.';
                        } else {
                            this.errors.applicant_full_name = '';
                        }
                        break;
                    case 'visitor_contact_no_india':
                        if (this.visitor_contact_no_india === '') {
                            this.errors.visitor_contact_no_india = 'This is required';
                        } else if (!/^\d{10}$/.test(this.visitor_contact_no_india)) {
                            this.errors.visitor_contact_no_india= 'Please enter a valid 10-digit phone number.';
                        } else {
                            this.errors.visitor_contact_no_india = '';
                        }
                        break;
                        case 'applicant_ppt_no':
                        if (this.applicant_ppt_no === '') {
                            this.errors.applicant_ppt_no = 'This is required';
                        }  else if (!/^[a-zA-Z0-9]{1,20}$/.test(this.applicant_ppt_no)) {
                              this.errors.applicant_ppt_no = 'Please enter a valid passport No. Only alphanumeric characters are allowed, and the maximum length is 20 characters.';
                            
                        } else {
                            this.errors.applicant_ppt_no = '';
                        }
                        break;
                    case 'applicant_nationality':
                        if (!this.applicant_nationality ) {
                            this.errors.applicant_nationality = 'This is Required';
                        } else {
                            this.errors.applicant_nationality= '';
                        }
                        break;
                    case 'visitor_visit_purpose_id':
                        if (!this.visitor_visit_purpose_id ) {
                            this.errors.visitor_visit_purpose_id = 'This is Required';
                        } else {
                            this.errors.visitor_visit_purpose_id= '';
                        }
                        break;
                    // case 'purpose':
                    //     if (!this.purpose){
                    //         this.errors.purpose= 'This is Required'
                    //     } else {
                    //         this.errors.purpose='';
                    //     }
                        
                }
            },
           validateForm() {
                this.errors = { visitor_full_name: '', visitor_address: '', visitor_visit_purpose_id: '', visitor_contact_no_india: '', applicant_ppt_no: '', applicant_full_name: '',applicant_nationality:'' };

                this.validateField('visitor_full_name');
                this.validateField('visitor_address');
                this.validateField('applicant_full_name');
                this.validateField('visitor_contact_no_india');
                this.validateField('applicant_ppt_no');
                this.validateField('applicant_nationality');
                this.validateField('visitor_visit_purpose_id');

                
        if (this.validateForm) {
            // If the form is valid, submit the form
            document.getElementById('user-form').submit();
        } else {
            this.showFormError();
        }
        },
        showFormErrors() {
            this.showErrors = {
                visitor_full_name: true,
                visitor_address: true,
                applicant_full_name: true,
                applicant_ppt_no: true,
                applicant_nationality: true,
                visitor_contact_no_india: true,
                visitor_visit_purpose_id: true,
            };
            this.validateField('visitor_full_name');
            this.validateField('visitor_address');
            this.validateField('applicant_full_name');
            this.validateField('visitor_contact_no_india');
            this.validateField('applicant_ppt_no');
            this.validateField('applicant_nationality');
            this.validateField('visitor_visit_purpose_id');
        },
        hideFormErrors() {
            this.showErrors = {
                visitor_full_name: false,
                visitor_address: false,
                applicant_full_name: false,
                applicant_ppt_no: false,
                applicant_nationality: false,
                visitor_contact_no_india: false,
                visitor_visit_purpose_id: false,
            };
        },
        showFormError() {
            this.formError = 'Please fill in all the fields correctly.';
        },
            resetForm() {
                this.visitor_full_name = '';
                this.visitor_address = '';
                this.applicant_full_name = '';
                this.visitor_contact_no_india = '';
                this.applicant_nationality = '';
                this.applicant_ppt_no = '';
                this.visitor_visit_purpose_id='';
                this. visitor_country_code_num='';
                this.visitor_contact_no_intnl='';
                this.webcamDataUrl = '';
                this.visitor_id_type_id='',
                this.visitor_id_type='',
                this.errors = {
                    visitor_full_name: '',
                    visitor_address: '',
                    applicant_full_name: '',
                    applicant_nationality: '',
                    applicant_ppt_no: '',
                    visitor_visit_purpose_id: '',
                    visitor_contact_no_india:'',
                    visitor_country_code_num:'',
                    visitor_contact_no_intnl:'',
                    visitor_id_type_id:'',
                };
                this.isFocused = {
                    visitor_full_name: false,
                    visitor_address: false,
                    applicant_full_name: false,
                    applicant_ppt_no: false,
                    visitor_contact_no_india: false,
                    visitor_visit_purpose_id: false,
                    applicant_nationality:false,
                    visitor_country_code_num:false,
                    visitor_id_type_id:false
                    
                };
                this.formError = '';
                    // Clear the image preview
                    document.getElementById('webcamPreview').src = '';
                // Clear the hidden input field
                document.getElementById('webcamDataUrl').value = '';
            },
             showFormError() {
            this.isFocused = {
                visitor_full_name: true,
                visitor_address: true,
                applicant_full_name: true,
                applicant_ppt_no: true,
                applicant_nationality: true,
                visitor_contact_no_india: true,
                visitor_visit_purpose_id: true,
                visitor_country_code_num: true,
                visitor_id_type_id: true,
            };
            this.formError = 'Please fill in all the fields correctly.';
        },
        hideFormError() {
            this.formError = '';
        },
            //visitorname same as applicantname
            syncApplicantName() {
            if (this.blnApplEqlsVstrName) {
                this.applicant_full_name = this.visitor_full_name ||'';
            } else {
                this.applicant_full_name = '';
            }
        },
        // passport  same as idtype
  syncPassportNo() {
    // Check if the ID type is "Passport" and the checkbox is checked
    if (this.visitor_id_type_id === '2' && this.blnIdEqualsPassport) {
        this.applicant_ppt_no = this.visitor_id_type; // Populate passport number
    } else {
        this.applicant_ppt_no = ''; // Clear the passport number if unchecked or if ID type is not Passport
    }
},showButton() {
                    return this.visitor_full_name.trim() !== '' && this.applicant_ppt_no.trim() !== '';
                },

        // dropdown label name change
         updateVisitorIdTypeLabel(event) {
                    const selectedOption = event.target.options[event.target.selectedIndex].text;
                    this.visitorIdTypeLabel = selectedOption === '-- Please Select --' ? ' ' : selectedOption ;
                }, 
                resetImagePreview() {
            this.webcamPreview = '';
            this.webcamDataUrl = '';
        }
        
                
                
             
                             
    }; // cam logic
}    document.addEventListener('DOMContentLoaded', function() {
        const webcam = document.getElementById('webcam');
        const webcamPreview = document.getElementById('webcamPreview');
        const webcamDataUrlInput = document.getElementById('webcamDataUrl');
        const cropperImage = document.getElementById('cropperImage');
        const cropperContainer = document.getElementById('cropperContainer');
        let videoStream = null;
        let cropper = null;

        document.getElementById('toggleWebcam').addEventListener('click', function() {
            if (webcam.srcObject) {
                stopWebcam();
                this.textContent = 'Start Camera';
            } else {
                initWebcam();
                this.textContent = 'Stop Camera';
            }
        });

        document.getElementById('captureImage').addEventListener('click', function() {
            if (!webcam.srcObject) {
                alert('Webcam is not started. Please start the webcam first.');
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = webcam.videoWidth;
            canvas.height = webcam.videoHeight;
            ctx.drawImage(webcam, 0, 0, canvas.width, canvas.height);
            const webcamDataUrl = canvas.toDataURL('image/png');
            webcamPreview.src = webcamDataUrl;
            webcamDataUrlInput.value = webcamDataUrl;

            // Turn off the webcam
            stopWebcam();
            document.getElementById('toggleWebcam').textContent = 'Start Camera';

            // Initialize cropper
            cropperImage.src = webcamDataUrl;
            cropperContainer.style.display = 'block';

            if (cropper) {
                cropper.destroy();
            }

            cropper = new Cropper(cropperImage, {
                aspectRatio: 1,
                viewMode: 1,
                preview: '.img-thumbnail'
            });
        });

        document.getElementById('cropImage').addEventListener('click', function() {
            if (cropper) {
                const canvas = cropper.getCroppedCanvas();
                const croppedDataUrl = canvas.toDataURL('image/png');
                webcamPreview.src = croppedDataUrl;
                webcamDataUrlInput.value = croppedDataUrl;
                cropper.destroy();
                cropperContainer.style.display = 'none';
            }
        });

        function initWebcam() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    videoStream = stream;
                    webcam.srcObject = stream;
                })
                .catch(err => {
                    console.error('Error accessing webcam: ', err);
                    alert('Could not access webcam. Please ensure that your browser has permission and that you are using HTTPS.');
                });
        }

        function stopWebcam() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                webcam.srcObject = null;
            }
        }
    });
    document.addEventListener('DOMContentLoaded', (event) => {
            // Optionally handle form reset or other actions
            let messageType = /*[[${messageType}]]*/ '';
            if (messageType === 'success') {
                // Handle success, e.g., clear form or show success-specific actions
                document.querySelector('form').reset();
            }
        });
         document.getElementById('visitor_visit_purpose_id').addEventListener('change', function() {
        console.log(this.value);
    });
window.onload = function() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('loader').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        };
</script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        
   

        
</body>
</html>
<style>
 body{
    background-color:white;
 }
    h2{
        font-size: large;
    margin-left: 15%;
    font-family:'poppins' ;
    background-color: rgb(245, 245, 235);
    display:inline-block;
    
    }
    
    
    .container {
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto; 
       margin: 0 ;
        display: flex;
        width: 100%;
        /* background-color: aqua; */
    }

    .logo{
        margin-top: 20px;
        padding: 20px;
        display: inline;
    }
    .logo div{
        overflow: hidden;
        width: 0;
        height: 0;
    }
    h4{
        margin-left: 30px;
        padding: 10px;
        display: inline;
    }
    .form{
        width: 200%;
        height: 400%;
       margin-left: 40px;
       background-color: rgb(242, 252, 251);
       margin-top: 5px;
       /* display:grid;
       grid-template-columns: 1fr 1fr 1fr;
       grid-template-rows:40px 40px; */
       gap:10px;
     
    
      
    }
    .logoName{
        margin-top: 100px;
        margin-left:-20px;
    }

   
    
    
    .form-control{
      /*  width: auto;*/
        column-gap: 20px;
        border-radius: 5px;
        /* border-width: 2.5px; */
        
        
    }
    .row{
        padding: 5px;
        margin-left: 10px;
        align-items: flex-start;
        margin-left: -15px;
        margin-right: 70px;
    
    }
    .col{
        column-gap: 50px;
        padding: 20px;
    }
    .text-danger{
        color: red;
      
        
    }
    .form-label{
        font-family:'poppins';
        font-weight: 100;
        font-size: medium;
    }
    .error {
            color: rgb(240, 7, 135);
            font-size:14px;
            font-family:poppins ;
            font-weight: 400;
          
    }
    .error-message {
    color: red;
    font-size: 0.875em;
    display: block;
    margin-top: 0.25em;
}
    .form-error {
            color: #ff0020;
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
        }
        .form-control[data-focused="true"] {
            border-color: rgb(255, 0, 64);

        }
        .form-control:focus {
            border-color: rgb(0, 215, 215);
            border-width: 2.5px;
            box-shadow:purple; 
            background-color: rgb(220, 241, 241);
        
        }

        button.submit {
            padding: 10px 15px;
            background-color: rgb(8, 157, 226);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: small;
            
        }
        button.reset {
            padding: 10px 15px;
            background-color: #f6f8f8;
            color: #116ffc;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: small;

        }
        button.submit:disabled {
            background-color:rgb(141, 201, 250);
            cursor: not-allowed;
         }
        button.reset:hover {
            background-color: #a2eeead2; 
            color: #3600f8;
        }
        .image-preview-container {
            position: absolute;
            top: 50px;
            right: 40px;
            z-index: 1000;
}
.image-preview-container img {
            display:block;
            margin-right: 20px;
        }
       
      
        
    /* Overlay */
.overlay {
    display: block; /* Ensures it is shown initially */
    position: fixed; /* Covers the entire viewport */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
    z-index: 9998; /* Positioned behind the loader but above other content */
}

/* Loader Container */
.loader-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    position: fixed; /* Ensures it covers the viewport */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 9999; /* Ensures it appears above the overlay */
}

/* Fading Bars */
.fading-bars {
    display: flex;
    justify-content: space-between;
    width: 80px;
}

.bar {
    width: 10px;
    height: 40px;
    background-color: rgb(0, 255, 255);
    animation: fade 1s infinite;
}

.bar:nth-child(1) {
    animation-delay: 0s;
}

.bar:nth-child(2) {
    animation-delay: 0.2s;
}

.bar:nth-child(3) {
    animation-delay: 0.4s;
}

.bar:nth-child(4) {
    animation-delay: 0.6s;
}

.bar:nth-child(5) {
    animation-delay: 0.8s;
}

/* Fade Animation */
@keyframes fade {
    0%, 100% {
        opacity: 0;
    }
    50% {
        opacity: 1;
    }
}

</style>

  